<!DOCTYPE html><html lang="en" class="bg-gradient-to-br from-green-100 via-white to-green-200 text-green-900">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Statistical Analysis App</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.4/dist/jstat.min.js"></script>
</head>
<body class="p-4 md:p-6 font-sans min-h-screen">
  <div class="container mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6">ðŸ“Š SmartStat Analysis App</h1>
    <input type="file" id="fileInput" accept=".csv" class="mb-4" />
    <button onclick="runAnalysis()" class="bg-green-600 text-white px-4 py-2 rounded">Run Analysis</button><div id="output" class="mt-6"></div>

<canvas id="barChart" class="mt-8"></canvas>
<canvas id="scatterChart" class="mt-8"></canvas>

<script>
  function runAnalysis() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) return alert("Please upload a CSV file.");

    Papa.parse(file, {
      header: true,
      dynamicTyping: true,
      complete: function(results) {
        const data = results.data.filter(row => Object.values(row).some(val => val !== null && val !== ""));
        const headers = results.meta.fields;
        document.getElementById('output').innerHTML = generateDescriptiveStats(data, headers);
        plotBarChart(data, headers);
        plotScatterChart(data, headers);
        runCorrelation(data, headers);
        runRegression(data, headers);
      }
    });
  }

  function generateDescriptiveStats(data, headers) {
    let html = '<h2 class="text-xl font-semibold mb-2">Descriptive Statistics</h2><table class="table-auto border w-full text-sm">';
    html += '<thead><tr><th class="border px-2">Variable</th><th class="border px-2">Mean</th><th class="border px-2">Min</th><th class="border px-2">Max</th></tr></thead><tbody>';

    headers.forEach(h => {
      const column = data.map(row => +row[h]).filter(n => !isNaN(n));
      if (column.length) {
        const mean = jStat.mean(column).toFixed(2);
        const min = Math.min(...column).toFixed(2);
        const max = Math.max(...column).toFixed(2);
        html += `<tr><td class="border px-2">${h}</td><td class="border px-2">${mean}</td><td class="border px-2">${min}</td><td class="border px-2">${max}</td></tr>`;
      }
    });

    html += '</tbody></table>';
    return html;
  }

  function plotBarChart(data, headers) {
    const ctx = document.getElementById('barChart').getContext('2d');
    const label = headers[0];
    const value = headers[1];
    const labels = data.map(row => row[label]);
    const values = data.map(row => +row[value]);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: `${value} by ${label}`,
          data: values,
          backgroundColor: 'rgba(34,197,94,0.5)',
          borderColor: 'rgba(34,197,94,1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Bar Chart'
          }
        }
      }
    });
  }

  function plotScatterChart(data, headers) {
    const ctx = document.getElementById('scatterChart').getContext('2d');
    const x = headers[0];
    const y = headers[1];
    const points = data.map(row => ({ x: +row[x], y: +row[y] })).filter(p => !isNaN(p.x) && !isNaN(p.y));

    new Chart(ctx, {
      type: 'scatter',
      data: {
        datasets: [{
          label: `${y} vs ${x}`,
          data: points,
          backgroundColor: 'rgba(16,185,129,0.6)'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Scatter Plot'
          }
        },
        scales: {
          x: { title: { display: true, text: x } },
          y: { title: { display: true, text: y } }
        }
      }
    });
  }

  function runCorrelation(data, headers) {
    const output = document.getElementById('output');
    let html = '<h2 class="text-xl font-semibold mt-8 mb-2">Correlation (Pearson)</h2><table class="table-auto border w-full text-sm">';
    html += '<thead><tr><th class="border px-2">X</th><th class="border px-2">Y</th><th class="border px-2">r</th></tr></thead><tbody>';

    for (let i = 0; i < headers.length; i++) {
      for (let j = i + 1; j < headers.length; j++) {
        const col1 = data.map(row => +row[headers[i]]).filter(n => !isNaN(n));
        const col2 = data.map(row => +row[headers[j]]).filter(n => !isNaN(n));
        if (col1.length && col1.length === col2.length) {
          const r = jStat.corrcoeff(col1, col2).toFixed(3);
          html += `<tr><td class="border px-2">${headers[i]}</td><td class="border px-2">${headers[j]}</td><td class="border px-2">${r}</td></tr>`;
        }
      }
    }

    html += '</tbody></table>';
    output.innerHTML += html;
  }

  function runRegression(data, headers) {
    const output = document.getElementById('output');
    const x = headers[0];
    const y = headers[1];
    const xs = data.map(row => +row[x]).filter(n => !isNaN(n));
    const ys = data.map(row => +row[y]).filter(n => !isNaN(n));

    if (xs.length && xs.length === ys.length) {
      const slope = jStat.models.ols(ys, jStat.addones(xs)).beta[1].toFixed(3);
      const intercept = jStat.models.ols(ys, jStat.addones(xs)).beta[0].toFixed(3);
      output.innerHTML += `<h2 class="text-xl font-semibold mt-8">Linear Regression</h2><p class="text-sm">${y} = ${intercept} + ${slope} Ã— ${x}</p>`;
    }
  }
</script>

  </div>
</body>
</html>
